# PubMed RAG 智能助理

一款专为医学研究人员、学生和临床医生设计的浏览器插件。它将先进的生成式AI（以Gemini和OpenAI兼容模型为主）与用户的研究工作流深度融合，旨在将一个宽泛的研究兴趣，通过人机协同的方式，转化为一份结构清晰、有理有据的文献综述报告。

## 核心解决的问题

-   **信息过载**: PubMed文献浩如烟海，手动筛选、阅读、总结耗时巨大。
-   **研究起点模糊**: 从一个模糊的想法到一个明确的研究问题，路径不清晰。
-   **文献总结效率低**: 阅读多篇全文后，在大脑中进行综合、提炼和撰写报告是一项高强度的认知劳动。

## 核心设计哲学

本项目并非一个全自动工具，而是一个**“智能研究代理” (Intelligent Research Agent)**。它遵循“人类在环路中”(Human-in-the-loop)的设计哲学，在关键节点与用户协商，确保AI的强大能力始终服务于用户的真实意图。

-   **分阶段的状态机**: 将复杂的研究流程拆解为清晰、可控的几个阶段。
-   **结构化的多层Prompt**: 为每个阶段设计专门的、高度优化的LLM指令。
-   **多会话管理**: 用户可以保存多个独立的研究项目，随时切换，互不干扰。

## 技术架构 (纯插件模式)

本插件采用纯前端、无后端的架构，所有计算和API请求都在用户浏览器内部完成，极大地降低了开发和维护成本，并保障了用户数据的私密性。

-   **框架**: Plasmo (一个能极大简化浏览器插件开发的现代框架)。
-   **前端**: React + TypeScript (确保代码的健壮性和可维护性)。
-   **状态管理**: Zustand (轻量级的全局状态管理库，用于在后台与UI间同步状态)。
-   **数据持久化**: `chrome.storage.local` (安全地在本地存储用户的会话数据和API密钥)。

## 详细工作流程 (三阶段模型)

#### 第一阶段: 规划与协商 (人机对话)

**目标**: 深度理解用户意图，并将一个大课题分解为多个可调查的子问题。

1.  **[用户] 输入研究兴趣**: 用户在PubMed网站打开插件侧边栏，输入一个研究主题，如：“肠道菌群与抑郁症的最新研究进展”。
2.  **[插件] 任务分解 (LLM调用 #1: 研究策略师)**: 后台脚本接收到主题，调用LLM API，生成一个包含多个子问题和对应搜索关键词的研究计划草案。
3.  **[用户] 协商与确认 (多轮对话)**: 
    *   侧边栏UI以卡片形式展示AI生成的研究计划。用户可以直接编辑、增删卡片。
    *   用户也可以在对话框中输入自然语言指令（如：“请合并关于治疗的两个问题”），让AI自动优化整个计划。
    *   此过程可反复进行，直到用户对计划满意为止。

#### 第二阶段: 自动初筛与评估 (插件自主执行)

**目标**: 根据研究计划，自动进行初步搜索，并利用LLM预评估文献的相关性。

1.  **[插件] 自动信息检索 (通过官方API)**:
    *   用户确认计划后，后台脚本开始执行。
    *   它根据计划中的所有关键词，**调用PubMed官方的E-utilities API**进行文献检索，获取一个包含PMID的列表。
    *   接着，再次调用API，根据PMID列表获取每篇文章的详细信息，包括完整的摘要。
2.  **[插件] 智能信源评估 (LLM调用 #2: 文献审阅人)**:
    *   收集到所有摘要后，后台脚本再次调用LLM。
    *   Prompt核心指令:“作为医学文献评审专家，请根据用户的研究计划，为以下每篇文献摘要的相关性打分(1-10分)，并提供一句话评审理由。”
3.  **[用户] 筛选信源**:
    *   侧边栏UI刷新，展示一个按AI评分排序的文献列表。
    *   每篇文献旁都有评分、评审理由和可展开的摘要，帮助用户快速判断。
    *   用户在此列表上勾选他们认为最值得深入阅读的文章。

#### 第三阶段: 人类辅助深度阅读与综述 (人机协作)

**目标**: 获取用户最终选定文献的全文，并生成一份综合性的研究报告。

1.  **[插件/用户] “人类辅助”全文获取**:
    *   用户点击“获取全文并生成报告”。
    *   后台脚本启动任务队列，按照用户在设置中定义的速率限制，使用`chrome.tabs.create`逐一在新标签页打开所选文献的链接。
    *   每打开一个页面，内容脚本就会被注入，自动抓取全文并发送回后台脚本，然后关闭该标签页。
2.  **[插件] 深度阅读与综述生成 (LLM调用 #3: 研究综述员)**:
    *   后台脚本收集到所有全文后，进行最后一次、也是最大的一次LLM调用。
    *   Prompt核心指令:“作为一名顶尖的医学研究员，请严格根据以下提供的几篇文献全文，并围绕用户的研究计划，撰写一份全面、客观、结构化的文献综述报告...”
3.  **[用户] 查看与导出报告**:
    *   最终生成的报告会以优美的Markdown格式呈现在侧边栏中。
    *   用户可以方便地复制报告内容，或将其导出为Markdown文件。

## 开发路线图

-   ✅ **里程碑 1: 项目搭建与设置页面** - 基础框架、多会话状态管理、API密钥配置页面。
-   ✅ **里程碑 2: 实现第一阶段 - “与AI对话”** - 完成了从主题输入到多轮对话协商研究计划的完整交互。
-   ✅ **里程碑 3: 实现第二阶段 - “让AI去搜索和评估”** - 完成了通过PubMed API自动检索和AI摘要评分的功能。
-   ➡️ **里程碑 4: 实现第三阶段 - “生成最终报告”** - **当前的核心任务**。
-   **里程碑 5: 优化与打磨** - 增加加载进度、错误处理、历史记录等。