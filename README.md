# PubMed RAG 智能助理

一款专为医学研究人员、学生和临床医生设计的浏览器插件。它将先进的生成式AI（以Gemini和OpenAI兼容模型为主）与用户的研究工作流深度融合，旨在将一个宽泛的研究兴趣，通过人机协同的方式，转化为一份结构清晰、有理有据的文献综述报告。

## 核心解决的问题

-   **信息过载**: PubMed文献浩如烟海，手动筛选、阅读、总结耗时巨大。
-   **研究起点模糊**: 从一个模糊的想法到一个明确的研究问题，路径不清晰。
-   **文献总结效率低**: 阅读多篇全文后，在大脑中进行综合、提炼和撰写报告是一项高强度的认知劳动。

## 核心设计哲学

本项目并非一个全自动工具，而是一个**“智能研究代理” (Intelligent Research Agent)**。它遵循“人类在环路中”(Human-in-the-loop)的设计哲学，在关键节点与用户协商，确保AI的强大能力始终服务于用户的真实意图。

-   **分阶段的状态机**: 将复杂的研究流程拆解为清晰、可控的几个阶段（规划、筛选、抓取、综述）。
-   **灵活的工作流**：采用分步式、可折叠的仪表盘界面，用户可以随时回顾、甚至修改上一步的“指令”，插件会自动处理后续步骤的更新，确保研究思路的灵活性。
-   **结构化的多层Prompt**: 为每个阶段设计专门的、高度优化的LLM指令，以确保输出质量。
-   **多会话管理**: 用户可以保存多个独立的研究项目，随时切换，互不干扰。

## 技术架构 (纯插件模式)

本插件采用纯前端、无后端的架构，所有计算和API请求都在用户浏览器内部完成，极大地降低了开发和维护成本，并保障了用户数据的私密性。

-   **框架**: Plasmo (一个能极大简化浏览器插件开发的现代框架)。
-   **前端**: React + TypeScript (确保代码的健壮性和可维护性)。
-   **状态管理**: Zustand (轻量级的全局状态管理库，用于在后台与UI间同步状态)。
-   **数据持久化**: `chrome.storage.local` (安全地在本地存储用户的会话数据和API密钥)。

## 详细工作流程

#### 第一阶段: 规划与协商 (人机对话)

**目标**: 深度理解用户意图，并将一个大课题分解为多个可调查的子问题。

1.  **[用户] 输入研究兴趣**: 用户在PubMed网站打开插件侧边栏，输入一个研究主题，如：“肠道菌群与抑郁症的最新研究进展”。
2.  **[插件] 任务分解 (LLM调用 #1: 研究策略师)**: 后台脚本接收到主题，调用LLM API，生成一个包含多个子问题和对应搜索关键词的研究计划草案。
3.  **[用户] 协商与确认**:
    * 侧边栏UI以卡片形式展示AI生成的研究计划。用户可以直接编辑、增删卡片。
    * 用户也可以在对话框中输入自然语言指令（如：“请合并关于治疗的两个问题”），让AI自动优化整个计划。
    * 此过程可反复进行，直到用户对计划满意为止。

#### 第二阶段: 自动初筛与评估 (插件自主执行)

**目标**: 根据研究计划，自动进行初步搜索，并利用LLM预评估文献的相关性。

1.  **[插件] 自动信息检索**:
    * 用户确认计划后，后台脚本调用PubMed官方的E-utilities API进行文献检索，获取文章列表及其摘要。
2.  **[插件] 智能信源评估 (LLM调用 #2: 文献审阅人)**:
    * 收集到所有摘要后，后台脚本再次调用LLM，指令其根据研究计划为每篇摘要的相关性打分(1-10分)，并提供一句话评审理由。
3.  **[用户] 筛选信源**:
    * 侧边栏UI刷新，展示一个按AI评分排序的文献列表。
    * 用户在此列表上勾选他们认为最值得深入阅读的文章。

#### 第三阶段: 用户主导的全文精读与综述 (人机协作)

**目标**: 在用户的引导下，获取最终选定文献的全文，并生成一份综合性的研究报告。

1.  **[用户] 启动全文抓取**: 在筛选完摘要后，用户进入全文抓取阶段。侧边栏会逐一提示需要处理的文章。
2.  **[插件 + 用户] 人机协作导航**:
    * 插件会为用户打开目标文章的 **PubMed 摘要页**。
    * **用户** 负责从该页面点击DOI或其他链接，**手动导航**至真正的全文页面（这可能需要登录机构账号等）。
    * 当用户确认当前页面已加载好全文后，返回侧边栏点击“抓取当前页面”。
3.  **[插件] 按需抓取**: 插件收到指令后，立刻通过内容脚本抓取**当前激活**的全文页面，并保存内容。此过程不会自动关闭页面，方便用户核对。
4.  **[插件] 深度阅读与综述生成 (LLM调用 #3: 研究综述员)**:
    * 当所有选定的文章都抓取完毕后，用户点击“生成报告”。
    * 后台脚本将所有全文内容和研究计划一同发送给LLM，指令其撰写一份全面、客观、结构化的文献综述报告，并正确引用来源（`[PMID:XXXXXX]`）。
5.  **[用户] 查看与导出报告**: 最终生成的报告会以Markdown格式呈现在侧边栏中，方便复制和使用。

## 开发路线图

-   ✅ **里程碑 1: 项目搭建与设置页面** - 基础框架、多会话状态管理、API密钥配置页面。
-   ✅ **里程碑 2: 实现第一阶段 - “与AI对话”** - 完成了从主题输入到多轮对话协商研究计划的完整交互。
-   ✅ **里程碑 3: 实现第二阶段 - “让AI去搜索和评估”** - 完成了通过PubMed API自动检索和AI摘要评分的功能。
-   ✅ **里程碑 4: 实现第三阶段 - “生成最终报告”** - 完成了基于人机协作的、用户主导的全文抓取和报告生成流程。
-   ➡️ **里程碑 5: 优化与打磨** - **当前的核心任务**。实现了分步式、可回顾、可修改的仪表盘界面，增强了工作流的灵活性。